# VastVideo-Go 启动脚本使用说明

本文档介绍如何使用增强后的 `start.sh` 脚本来灵活启动前端、后端或全栈服务。

## 🚀 功能特性

- ✅ **全栈模式**: 同时启动前端Vue和后端Go服务 (默认)
- ✅ **前端模式**: 仅启动Vue前端开发服务器
- ✅ **后端模式**: 仅启动Go后端服务
- ✅ **智能环境检查**: 根据启动模式检查相应依赖
- ✅ **自动浏览器启动**: macOS系统自动打开浏览器
- ✅ **优雅关闭**: Ctrl+C安全停止所有服务
- ✅ **详细日志**: 清晰的启动过程和状态信息

## 📖 使用方法

### 基础语法

```bash
./start.sh [选项]
```

### 可用选项

| 参数 | 长参数 | 描述 | 示例 |
|------|--------|------|------|
| (无) | (无) | 启动前端+后端 (全栈模式) | `./start.sh` |
| `-f` | `--frontend` | 仅启动前端Vue服务 | `./start.sh -f` |
| `-b` | `--backend` | 仅启动后端Go服务 | `./start.sh -b` |
| `-h` | `--help` | 显示帮助信息 | `./start.sh -h` |

### 服务地址

| 服务 | 地址 | 说明 |
|------|------|------|
| 前端 | http://localhost:3000 | Vue开发服务器 |
| 后端 | http://localhost:8228 | Go后端API服务 |

## 🎯 使用场景

### 1. 全栈开发 (默认)

```bash
./start.sh
```

**适用场景:**
- 完整的前后端开发
- 功能测试和调试
- 演示和生产预览

**启动内容:**
- ✅ Vue前端开发服务器 (端口3000)
- ✅ Go后端API服务 (端口8228)
- ✅ 自动打开浏览器访问前端
- ✅ API代理配置生效

### 2. 前端开发

```bash
./start.sh --frontend
# 或
./start.sh -f
```

**适用场景:**
- 专注前端界面开发
- 前端组件调试
- UI/UX设计验证
- 后端服务已由其他方式启动

**启动内容:**
- ✅ Vue前端开发服务器 (端口3000)
- ✅ 热重载和开发工具
- ✅ 自动打开浏览器
- ❌ 不启动后端服务

### 3. 后端开发

```bash
./start.sh --backend
# 或
./start.sh -b
```

**适用场景:**
- 专注后端API开发
- 接口测试和调试
- 数据库操作测试
- 前端已由其他方式启动

**启动内容:**
- ✅ Go后端编译和启动 (端口8228)
- ✅ API服务和路由
- ✅ 自动打开浏览器访问后端
- ❌ 不启动前端服务

## 🔧 环境依赖

脚本会根据启动模式智能检查环境依赖：

### 全栈模式依赖
- Go 语言环境
- Node.js 环境  
- npm 包管理器
- web/ 目录下的Vue项目

### 前端模式依赖
- Node.js 环境
- npm 包管理器
- web/ 目录下的Vue项目

### 后端模式依赖
- Go 语言环境
- Go项目源码和依赖

## 🖥️ 平台支持

### macOS (推荐)
- ✅ 自动检测系统类型
- ✅ 自动启动默认浏览器
- ✅ 获取本地IP地址显示

### Linux/其他系统
- ✅ 完整功能支持
- ⚠️ 需要手动打开浏览器
- ℹ️ 显示访问地址提示

## 🚦 启动流程

### 全栈模式启动流程

1. **环境检查**: Go + Node.js + npm
2. **Go编译**: 清理 → 编译 → 验证
3. **前端准备**: 检查依赖 → 安装(如需)
4. **服务启动**: 
   - 前端服务(后台) → 等待3秒 → 验证
   - 后端服务(前台) → 等待3秒
5. **浏览器启动**: macOS自动启动 / 其他系统提示
6. **运行监控**: 前台显示后端日志
7. **优雅退出**: Ctrl+C → 停止所有服务

### 前端模式启动流程

1. **环境检查**: Node.js + npm
2. **前端准备**: 检查依赖 → 安装(如需)
3. **服务启动**: 前端服务 → 等待3秒 → 验证
4. **浏览器启动**: 自动打开前端页面
5. **运行监控**: 前台运行前端服务
6. **优雅退出**: Ctrl+C → 停止前端服务

### 后端模式启动流程

1. **环境检查**: Go语言环境
2. **Go编译**: 清理 → 编译 → 验证
3. **服务启动**: 后端服务 → 等待3秒
4. **浏览器启动**: 自动打开后端页面
5. **运行监控**: 前台显示后端日志
6. **优雅退出**: Ctrl+C → 停止后端服务

## 📋 常见用法示例

### 开发调试场景

```bash
# 开发前端界面，后端已运行
./start.sh -f

# 开发后端API，前端已运行  
./start.sh -b

# 完整系统开发和测试
./start.sh
```

### 团队协作场景

```bash
# 前端开发者专用
./start.sh --frontend

# 后端开发者专用
./start.sh --backend

# 全栈开发者或项目演示
./start.sh
```

### 问题排查场景

```bash
# 检查后端服务是否正常
./start.sh -b

# 检查前端构建是否正常
./start.sh -f

# 检查前后端通信是否正常
./start.sh
```

## 🛑 停止服务

所有模式都支持优雅停止：

```bash
# 在运行中的终端按下
Ctrl + C
```

脚本会自动：
1. 检测运行中的服务
2. 发送停止信号
3. 等待进程安全退出
4. 显示停止确认信息

## 🐛 故障排除

### 1. 环境检查失败

**错误**: `❌ 错误: 未找到 Go 环境`
**解决**: 安装相应的开发环境

### 2. 端口被占用

**现象**: 后端启动失败，端口8228被占用
**解决**: 
```bash
# 查找占用进程
lsof -i :8228

# 杀死占用进程
kill -9 <PID>
```

### 3. 前端依赖问题

**现象**: 前端启动失败，依赖错误
**解决**:
```bash
cd web
rm -rf node_modules package-lock.json
npm install
```

### 4. Go编译失败

**现象**: `❌ Go后端编译失败!`
**解决**: 检查Go代码语法和依赖

### 5. 权限问题

**现象**: `permission denied`
**解决**:
```bash
chmod +x start.sh
```

## 🔍 日志和调试

### 前端日志

```bash
# 查看前端启动日志
tail -f frontend.log
```

### 后端日志

```bash
# 查看后端运行日志
tail -f vastproxy-go.log
```

### 系统进程

```bash
# 查看运行中的服务进程
ps aux | grep -E "(npm|vastvideo-go)"
```

## 📝 高级技巧

### 1. 后台运行全栈服务

```bash
# 后台启动全栈服务
nohup ./start.sh > startup.log 2>&1 &

# 查看启动日志
tail -f startup.log

# 停止后台服务
pkill -f "start.sh"
```

### 2. 指定不同配置

```bash
# 可以在脚本中传递额外参数给后端
# (需要修改脚本以支持参数传递)
```

### 3. 开发环境变量

```bash
# 设置开发环境变量
export NODE_ENV=development
export GO_ENV=development
./start.sh
```

## 📞 获取帮助

```bash
# 显示详细帮助信息
./start.sh --help

# 查看脚本版本和功能
head -20 start.sh
```

---

🎉 **恭喜！** 您现在可以灵活地启动VastVideo-Go的前端、后端或全栈服务了！

根据您的开发需求选择合适的启动模式，享受高效的开发体验！ 